import{_ as It}from"./Cvu1Dgpu.js";import{_ as lt}from"./Ba_o3TaL.js";import{_ as Ae,f as Ze,g as W,M as Rt,c as $,o as E,b as Ce,a as J,w as nt,d as rt,t as xe,u as v,F as ue,r as me,h as ye,i as _e,e as st,s as jt,j as Be,v as yt,k as ze,l as Qe}from"./BdRrNSXW.js";import{u as it,a as ot}from"./CKe5z4Gr.js";import{u as Ct}from"./B7N9frF5.js";import"./CdizknS0.js";const At={class:"search-results-interview"},Et={class:"preview"},Lt=["innerHTML"],Tt={__name:"SearchResultsInterview",props:{interviewId:Number,matches:Array,projectSlug:String},setup(e){const t=it(),s=e,{interviewId:n,matches:l,projectSlug:r}=Ze(s),o=W(()=>t.byId(n.value)[0]),u=W(()=>l.value.filter(({field:M})=>!["Name"].includes(M))),k=Rt({breaks:!0,html:!0});return(M,F)=>{const Z=lt;return E(),$("div",At,[Ce(Z,{to:`/projects/${v(r)}/interviews/${v(o).Slug}`},{default:nt(()=>[rt(xe(v(o).Name),1)]),_:1},8,["to"]),J("div",Et,[(E(!0),$(ue,null,me(v(u),j=>(E(),$("div",{key:j.field},[J("div",{innerHTML:v(k).render(j.highlighted)},null,8,Lt)]))),128))])])}}},bt=Ae(Tt,[["__scopeId","data-v-7e2c7d20"]]),$t={class:"search-results-project"},kt={class:"title"},Mt={key:0,class:"results-count"},Bt={key:0,class:"interviews-list"},Ne=3,zt={__name:"SearchResultsProject",props:{projectId:Number,searchActive:Boolean,interviews:Array},setup(e){const t=ot(),s=e,{projectId:n,searchActive:l,interviews:r}=Ze(s),o=ye(!1),u=W(()=>t.byId(n.value)[0]),k=W(()=>o.value?r.value:r.value.slice(0,Ne)),M=W(()=>!o.value&&r.value.length>Ne),F=W(()=>o.value&&r.value.length>Ne);return(Z,j)=>{const y=lt,x=bt;return E(),$("div",$t,[J("span",kt,[Ce(y,{to:`/projects/${v(u).Slug}`},{default:nt(()=>[rt(xe(v(u).Name),1)]),_:1},8,["to"]),v(l)?(E(),$("div",Mt,xe(v(r).length)+" results ",1)):_e("",!0)]),v(l)&&v(k).length>0?(E(),$("div",Bt,[(E(!0),$(ue,null,me(v(k),P=>(E(),st(x,{key:P.id,"interview-id":P.id,matches:P.matches,"project-slug":v(u).Slug},null,8,["interview-id","matches","project-slug"]))),128))])):_e("",!0),v(l)?(E(),$(ue,{key:1},[v(M)?(E(),$("button",{key:0,class:"expand-toggle",onClick:j[0]||(j[0]=P=>o.value=!0)},"show more")):_e("",!0),v(F)?(E(),$("button",{key:1,class:"expand-toggle",onClick:j[1]||(j[1]=P=>o.value=!1)},"show less")):_e("",!0)],64)):_e("",!0)])}}},Nt=Ae(zt,[["__scopeId","data-v-20bb3618"]]),Pt={class:"search-results"},Ot={__name:"SearchResults",props:{searchActive:Boolean,results:Array},setup(e){const t=e,{results:s,searchActive:n}=Ze(t);return(l,r)=>{const o=Nt;return E(),$("div",Pt,[(E(!0),$(ue,null,me(v(s),u=>(E(),st(o,{key:u.id,"project-id":u.id,interviews:u.interviews,"search-active":v(n)},null,8,["project-id","interviews","search-active"]))),128))])}}},Ut=Ae(Ot,[["__scopeId","data-v-594e1f6b"]]),at=(e,t)=>e>t?1:e<t?-1:0,Ve=1/0,Pe=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),We="eexxaacctt",Vt=new RegExp("\\p{P}","gu"),Zt="A-Z",Dt="a-z",Ht=["en",{numeric:!0,sensitivity:"base"}],de=(e,t,s)=>e.replace(Zt,t).replace(Dt,s),Je={unicode:!1,alpha:null,interSplit:"[^A-Za-z\\d']+",intraSplit:"[a-z][A-Z]",interBound:"[^A-Za-z\\d]",intraBound:"[A-Za-z]\\d|\\d[A-Za-z]|[a-z][A-Z]",interLft:0,interRgt:0,interChars:".",interIns:Ve,intraChars:"[a-z\\d']",intraIns:null,intraContr:"'[a-z]{1,2}\\b",intraMode:0,intraSlice:[1,Ve],intraSub:null,intraTrn:null,intraDel:null,intraFilt:(e,t,s)=>!0,toUpper:e=>e.toLocaleUpperCase(),toLower:e=>e.toLocaleLowerCase(),compare:null,sort:(e,t,s,n=at)=>{let{idx:l,chars:r,terms:o,interLft2:u,interLft1:k,start:M,intraIns:F,interIns:Z,cases:j}=e;return l.map((y,x)=>x).sort((y,x)=>r[x]-r[y]||F[y]-F[x]||o[x]+u[x]+.5*k[x]-(o[y]+u[y]+.5*k[y])||Z[y]-Z[x]||M[y]-M[x]||j[x]-j[y]||n(t[l[y]],t[l[x]]))}},Oe=(e,t)=>t==0?"":t==1?e+"??":t==Ve?e+"*?":e+`{0,${t}}?`,Ye="(?:\\b|_)";function Ie(e){e=Object.assign({},Je,e);let{unicode:t,interLft:s,interRgt:n,intraMode:l,intraSlice:r,intraIns:o,intraSub:u,intraTrn:k,intraDel:M,intraContr:F,intraSplit:Z,interSplit:j,intraBound:y,interBound:x,intraChars:P,toUpper:G,toLower:g,compare:fe}=e;o??=l,u??=l,k??=l,M??=l,fe??=typeof Intl>"u"?at:new Intl.Collator(...Ht).compare;let ve=e.letters??e.alpha;if(ve!=null){let i=G(ve),p=g(ve);j=de(j,i,p),Z=de(Z,i,p),x=de(x,i,p),y=de(y,i,p),P=de(P,i,p),F=de(F,i,p)}let R=t?"u":"";const he='".+?"',ft=new RegExp(he,"gi"+R),ht=new RegExp(`(?:\\s+|^)-(?:${P}+|${he})`,"gi"+R);let{intraRules:Ee}=e;Ee==null&&(Ee=i=>{let p=Je.intraSlice,m=0,C=0,c=0,f=0;if(/[^\d]/.test(i)){let I=i.length;I<=4?I>=3&&(c=Math.min(k,1),I==4&&(m=Math.min(o,1))):(p=r,m=o,C=u,c=k,f=M)}return{intraSlice:p,intraIns:m,intraSub:C,intraTrn:c,intraDel:f}});let pt=!!Z,gt=new RegExp(Z,"g"+R),dt=new RegExp(j,"g"+R),_t=new RegExp("^"+j+"|"+j+"$","g"+R),mt=new RegExp(F,"gi"+R);const we=(i,p=!1)=>{let m=[];i=i.replace(ft,c=>(m.push(c),We)),i=i.replace(_t,""),p||(i=g(i)),pt&&(i=i.replace(gt,c=>c[0]+" "+c[1]));let C=0;return i.split(dt).filter(c=>c!="").map(c=>c===We?m[C++]:c)},vt=/[^\d]+|\d+/g,Le=(i,p=0,m=!1)=>{let C=we(i);if(C.length==0)return[];let c=Array(C.length).fill("");C=C.map((O,U)=>O.replace(mt,N=>(c[U]=N,"")));let f;if(l==1)f=C.map((O,U)=>{if(O[0]==='"')return Pe(O.slice(1,-1));let N="";for(let B of O.matchAll(vt)){let a=B[0],{intraSlice:_,intraIns:S,intraSub:h,intraTrn:w,intraDel:d}=Ee(a);if(S+h+w+d==0)N+=a+c[U];else{let[D,V]=_,H=a.slice(0,D),le=a.slice(V),z=a.slice(D,V);S==1&&H.length==1&&H!=z[0]&&(H+="(?!"+H+")");let se=z.length,ne=[a];if(h)for(let A=0;A<se;A++)ne.push(H+z.slice(0,A)+P+z.slice(A+1)+le);if(w)for(let A=0;A<se-1;A++)z[A]!=z[A+1]&&ne.push(H+z.slice(0,A)+z[A+1]+z[A]+z.slice(A+2)+le);if(d)for(let A=0;A<se;A++)ne.push(H+z.slice(0,A+1)+"?"+z.slice(A+1)+le);if(S){let A=Oe(P,1);for(let ie=0;ie<se;ie++)ne.push(H+z.slice(0,ie)+A+z.slice(ie)+le)}N+="(?:"+ne.join("|")+")"+c[U]}}return N});else{let O=Oe(P,o);p==2&&o>0&&(O=")("+O+")("),f=C.map((U,N)=>U[0]==='"'?Pe(U.slice(1,-1)):U.split("").map((B,a,_)=>(o==1&&a==0&&_.length>1&&B!=_[a+1]&&(B+="(?!"+B+")"),B)).join(O)+c[N])}let I=s==2?Ye:"",Y=n==2?Ye:"",ee=Y+Oe(e.interChars,e.interIns)+I;return p>0?m?f=I+"("+f.join(")"+Y+"|"+I+"(")+")"+Y:(f="("+f.join(")("+ee+")(")+")",f="(.??"+I+")"+f+"("+Y+".*)"):(f=f.join(ee),f=I+f+Y),[new RegExp(f,"i"+R),C,c]},Re=(i,p,m)=>{let[C]=Le(p);if(C==null)return null;let c=[];if(m!=null)for(let f=0;f<m.length;f++){let I=m[f];C.test(i[I])&&c.push(I)}else for(let f=0;f<i.length;f++)C.test(i[f])&&c.push(f);return c};let De=!!y,Te=new RegExp(x,R),be=new RegExp(y,R);const He=(i,p,m)=>{let[C,c,f]=Le(m,1),I=we(m,!0),[Y]=Le(m,2),ee=c.length,O=Array(ee),U=Array(ee);for(let h=0;h<ee;h++){let w=c[h],d=I[h],D=w[0]=='"'?w.slice(1,-1):w+f[h],V=d[0]=='"'?d.slice(1,-1):d+f[h];O[h]=D,U[h]=V}let N=i.length,B=Array(N).fill(0),a={idx:Array(N),start:B.slice(),chars:B.slice(),cases:B.slice(),terms:B.slice(),interIns:B.slice(),intraIns:B.slice(),interLft2:B.slice(),interRgt2:B.slice(),interLft1:B.slice(),interRgt1:B.slice(),ranges:Array(N)},_=s==1||n==1,S=0;for(let h=0;h<i.length;h++){let w=p[i[h]],d=w.match(C),D=d.index+d[1].length,V=D,H=!1,le=0,z=0,se=0,ne=0,A=0,ie=0,qe=0,Fe=0,Ge=0,oe=[];for(let L=0,b=2;L<ee;L++,b+=2){let re=g(d[b]),X=O[L],ke=U[L],K=X.length,Q=re.length,q=re==X;if(d[b]==ke&&qe++,!q&&d[b+1].length>=K){let T=g(d[b+1]).indexOf(X);T>-1&&(oe.push(V,Q,T,K),V+=$e(d,b,T,K),re=X,Q=K,q=!0,L==0&&(D=V))}if(_||q){let T=V-1,te=V+Q,ae=!1,Se=!1;if(T==-1||Te.test(w[T]))q&&le++,ae=!0;else{if(s==2){H=!0;break}if(De&&be.test(w[T]+w[T+1]))q&&z++,ae=!0;else if(s==1){let je=d[b+1],pe=V+Q;if(je.length>=K){let ce=0,ge=!1,xt=new RegExp(X,"ig"+R),Xe;for(;Xe=xt.exec(je);){ce=Xe.index;let Ke=pe+ce,Me=Ke-1;if(Me==-1||Te.test(w[Me])){le++,ge=!0;break}else if(be.test(w[Me]+w[Ke])){z++,ge=!0;break}}ge&&(ae=!0,oe.push(V,Q,ce,K),V+=$e(d,b,ce,K),re=X,Q=K,q=!0,L==0&&(D=V))}if(!ae){H=!0;break}}}if(te==w.length||Te.test(w[te]))q&&se++,Se=!0;else{if(n==2){H=!0;break}if(De&&be.test(w[te-1]+w[te]))q&&ne++,Se=!0;else if(n==1){H=!0;break}}q&&(A+=K,ae&&Se&&ie++)}if(Q>K&&(Ge+=Q-K),L>0&&(Fe+=d[b-1].length),!e.intraFilt(X,re,V)){H=!0;break}L<ee-1&&(V+=Q+d[b+1].length)}if(!H){a.idx[S]=i[h],a.interLft2[S]=le,a.interLft1[S]=z,a.interRgt2[S]=se,a.interRgt1[S]=ne,a.chars[S]=A,a.terms[S]=ie,a.cases[S]=qe,a.interIns[S]=Fe,a.intraIns[S]=Ge,a.start[S]=D;let L=w.match(Y),b=L.index+L[1].length,re=oe.length,X=re>0?0:1/0,ke=re-4;for(let T=2;T<L.length;){let te=L[T].length;if(X<=ke&&oe[X]==b){let ae=oe[X+1],Se=oe[X+2],je=oe[X+3],pe=T,ce="";for(let ge=0;ge<ae;pe++)ce+=L[pe],ge+=L[pe].length;L.splice(T,pe-T,ce),b+=$e(L,T,Se,je),X+=4}else b+=te,T++}b=L.index+L[1].length;let K=a.ranges[S]=[],Q=b,q=b;for(let T=2;T<L.length;T++){let te=L[T].length;b+=te,T%2==0?q=b:te>0&&(K.push(Q,q),Q=q=b)}q>Q&&K.push(Q,q),S++}}if(S<i.length)for(let h in a)a[h]=a[h].slice(0,S);return a},$e=(i,p,m,C)=>{let c=i[p]+i[p+1].slice(0,m);return i[p-1]+=c,i[p]=i[p+1].slice(m,m+C),i[p+1]=i[p+1].slice(m+C),c.length},wt=5,St=(i,p,m,C=1e3,c)=>{m=m?m===!0?wt:m:0;let f=null,I=null,Y=[];p=p.replace(ht,a=>{let _=a.trim().slice(1);return _=_[0]==='"'?Pe(_.slice(1,-1)):_.replace(Vt,""),_!=""&&Y.push(_),""});let ee=we(p),O;if(Y.length>0){if(O=new RegExp(Y.join("|"),"i"+R),ee.length==0){let a=[];for(let _=0;_<i.length;_++)O.test(i[_])||a.push(_);return[a,null,null]}}else if(ee.length==0)return[null,null,null];if(m>0){let a=we(p);if(a.length>1){let _=a.slice().sort((h,w)=>w.length-h.length);for(let h=0;h<_.length;h++){if(c?.length==0)return[[],null,null];c=Re(i,_[h],c)}if(a.length>m)return[c,null,null];f=ct(a).map(h=>h.join(" ")),I=[];let S=new Set;for(let h=0;h<f.length;h++)if(S.size<c.length){let w=c.filter(D=>!S.has(D)),d=Re(i,f[h],w);for(let D=0;D<d.length;D++)S.add(d[D]);I.push(d)}else I.push([])}}f==null&&(f=[p],I=[c?.length>0?c:Re(i,p)]);let U=null,N=null;if(Y.length>0&&(I=I.map(a=>a.filter(_=>!O.test(i[_])))),I.reduce((a,_)=>a+_.length,0)<=C){U={},N=[];for(let a=0;a<I.length;a++){let _=I[a];if(_==null||_.length==0)continue;let S=f[a],h=He(_,i,S),w=e.sort(h,i,S,fe);if(a>0)for(let d=0;d<w.length;d++)w[d]+=N.length;for(let d in h)U[d]=(U[d]??[]).concat(h[d]);N=N.concat(w)}}return[[].concat(...I),U,N]};return{search:(...i)=>St(...i),split:we,filter:Re,info:He,sort:e.sort}}const qt=(()=>{let e={A:"ÁÀÃÂÄĄ",a:"áàãâäą",E:"ÉÈÊËĖ",e:"éèêëę",I:"ÍÌÎÏĮ",i:"íìîïį",O:"ÓÒÔÕÖ",o:"óòôõö",U:"ÚÙÛÜŪŲ",u:"úùûüūų",C:"ÇČĆ",c:"çčć",L:"Ł",l:"ł",N:"ÑŃ",n:"ñń",S:"ŠŚ",s:"šś",Z:"ŻŹ",z:"żź"},t=new Map,s="";for(let r in e)e[r].split("").forEach(o=>{s+=o,t.set(o,r)});let n=new RegExp(`[${s}]`,"g"),l=r=>t.get(r);return r=>{if(typeof r=="string")return r.replace(n,l);let o=Array(r.length);for(let u=0;u<r.length;u++)o[u]=r[u].replace(n,l);return o}})();function ct(e){e=e.slice();let t=e.length,s=[e.slice()],n=new Array(t).fill(0),l=1,r,o;for(;l<t;)n[l]<l?(r=l%2&&n[l],o=e[l],e[l]=e[r],e[r]=o,++n[l],l=1,s.push(e.slice())):(n[l]=0,++l);return s}const Ft=(e,t)=>t?`<mark>${e}</mark>`:e,Gt=(e,t)=>e+t;function Xt(e,t,s=Ft,n="",l=Gt){n=l(n,s(e.substring(0,t[0]),!1))??n;for(let r=0;r<t.length;r+=2){let o=t[r],u=t[r+1];n=l(n,s(e.substring(o,u),!0))??n,r<t.length-3&&(n=l(n,s(e.substring(t[r+1],t[r+2]),!1))??n)}return n=l(n,s(e.substring(t[t.length-1]),!1))??n,n}Ie.latinize=qt;Ie.permute=e=>ct([...Array(e.length).keys()]).sort((s,n)=>{for(let l=0;l<s.length;l++)if(s[l]!=n[l])return s[l]-n[l];return 0}).map(s=>s.map(n=>e[n]));Ie.highlight=Xt;function Kt(e,t){const s={};for(let n=0;n<e.length;n++){const l=e[n],r=t(l);Object.hasOwn(s,r)||(s[r]=[]),s[r].push(l)}return s}const et=(e,t,s,n,l)=>{let r=s,o=0,u=e;for(;r>0&&s-r<l&&o<n;)u=u.slice(0,r),r=u.lastIndexOf(t),o++;return r<=0?0:r+t.length},tt=(e,t,s,n,l)=>{let r=s,o=0,u=e.slice(r);for(;u.indexOf(t>=0)&&r<e.length-1&&r-s<l&&o<n;){const k=u.indexOf(t)+t.length;u=u.slice(k),r+=k,o++}return r-s>l?s+l:r},Qt=(e,t,s)=>{let n=et(e,". ",t,1,50);(n<0||n===t)&&(n=et(e," ",t,10,50));let l=tt(e,". ",s,1,50);return(l===s+50||l===s)&&(l=tt(e," ",s,10,50)),{excerpt:e.slice(n,l),min:n,max:l}},Ue=(e,t,s)=>{const n=new Ie({interIns:20}),l=e.map(M=>M[t]),[r,o,u]=n.search(l,s);return r==null||r.length===0?[]:u.map(M=>{const F=o.idx[M],Z=l[o.idx[M]],j=o.ranges[M],{excerpt:y,min:x,max:P}=Qt(Z,j[0],j.slice(-1)[0]);let G=Ie.highlight(y,j.map(g=>g-x)).trim();return x>0&&(G="[...] "+G),P<Z.length&&(G=G+" [...]"),{index:F,field:t,highlighted:G,excerpt:y,min:x}})},ut=(e,t,s)=>{const n=Object.entries(e).map(([l,r])=>{const o=s[l];return{id:o.Id,projects:o.Projects,matches:r}});return t.map(l=>({id:l.Id,interviews:n.filter(r=>r.projects.includes(l.RecordId))}))},Wt=(e,t)=>{const s=Object.fromEntries(t.map((n,l)=>[l,[]]));return ut(s,e,t)},Jt=(e,t,s)=>{const n=[...Ue(t,"Name",s),...Ue(t,"Description",s),...Ue(t,"Transcription",s)],l=Kt(n,r=>r.index);return ut(l,e,t)},Yt={class:"page-medium"},el={class:"filters"},tl={class:"filters-row"},ll={class:"filters-row"},nl=["label"],rl=["value"],sl={key:0,class:"too-generic-message"},il={__name:"index",setup(e){const t=ye(""),s=ye(""),n=ye(""),l=it(),r=ot(),o=Ct(),u=W(()=>l.interviews),k=W(()=>r.projects),{themes:M}=jt(o),F=W(()=>k.value.filter(G=>{let g=!0;return t.value!==""&&(g=G?.["Themes (new)"]?.includes(t.value)??!1),s.value!==""&&(g=G?.Keywords?.includes(s.value)??!1),g})),Z=W(()=>{const G=k.value.map(({Keywords:g})=>g).flat().filter(g=>!!g);return[...new Set(G)].sort((g,fe)=>g.localeCompare(fe))}),j=W(()=>Wt(F.value,u.value)),y=W(()=>n.value.length<3?j.value:Jt(F.value,u.value,n.value)),x=W(()=>y.value.map(({interviews:g})=>g).flat().length>=u.value.length*.97),P=W(()=>x.value?j.value:y.value);return(G,g)=>{const fe=It,ve=Ut;return E(),$("div",Yt,[g[5]||(g[5]=J("h1",null,"Oral History Projects",-1)),Ce(fe,{name:"Oral History Projects"}),J("div",el,[J("div",tl,[Be(J("input",{"onUpdate:modelValue":g[0]||(g[0]=R=>ze(n)?n.value=R:null),type:"search",placeholder:"Search within oral histories"},null,512),[[yt,v(n)]])]),J("div",ll,[Be(J("select",{"onUpdate:modelValue":g[1]||(g[1]=R=>ze(t)?t.value=R:null),class:"themes-input"},[g[3]||(g[3]=J("option",{value:""},"search by theme",-1)),(E(!0),$(ue,null,me(v(M),R=>(E(),$("optgroup",{key:R.id,label:R.name},[(E(!0),$(ue,null,me(R.subthemes,he=>(E(),$("option",{key:he.id,value:he.id},xe(he.name),9,rl))),128))],8,nl))),128))],512),[[Qe,v(t)]]),Be(J("select",{"onUpdate:modelValue":g[2]||(g[2]=R=>ze(s)?s.value=R:null)},[g[4]||(g[4]=J("option",{value:""},"search by category",-1)),(E(!0),$(ue,null,me(v(Z),R=>(E(),$("option",{key:R},xe(R),1))),128))],512),[[Qe,v(s)]])])]),v(n).length>=3&&v(x)?(E(),$("div",sl," This query matched most of the interviews, try something more specific. ")):_e("",!0),J("div",null,[Ce(ve,{"search-active":v(n).length>=3&&!v(x),results:v(P)},null,8,["search-active","results"])])])}}},pl=Ae(il,[["__scopeId","data-v-6d74e7cb"]]);export{pl as default};
