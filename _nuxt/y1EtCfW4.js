import{_ as It}from"./CzOXtKNA.js";import{_ as lt}from"./Dd3gCbqu.js";import{_ as Ae,k as Ve,f as X,l as Rt,o as b,c as z,b as ye,w as nt,d as rt,t as we,u as v,a as Y,F as me,r as Se,g as Ce,i as de,e as st,p as Me,v as Ct,q as Be,s as We}from"./DEx55Oms.js";import{a as it,u as ot}from"./CkdD8FXa.js";import"./okMUzUJl.js";import"./D43SHYPB.js";const yt={class:"search-results-interview"},At={class:"preview"},jt=["innerHTML"],Et={__name:"SearchResultsInterview",props:{interviewId:Number,matches:Array,projectSlug:String},setup(e){const t=it(),s=e,{interviewId:n,matches:l,projectSlug:r}=Ve(s),o=X(()=>t.byId(n.value)[0]),f=X(()=>l.value.filter(({field:k})=>!["Name"].includes(k))),$=Rt({breaks:!0,html:!0});return(k,J)=>{const P=lt;return b(),z("div",yt,[ye(P,{to:`/projects/${v(r)}/interviews/${v(o).Slug}`},{default:nt(()=>[rt(we(v(o).Name),1)]),_:1},8,["to"]),Y("div",At,[(b(!0),z(me,null,Se(v(f),C=>(b(),z("div",{key:C.field},[Y("div",{innerHTML:v($).render(C.highlighted)},null,8,jt)]))),128))])])}}},Lt=Ae(Et,[["__scopeId","data-v-7e2c7d20"]]),Tt={class:"search-results-project"},bt={class:"title"},$t={key:0,class:"results-count"},kt={key:0,class:"interviews-list"},ze=3,Mt={__name:"SearchResultsProject",props:{projectId:Number,searchActive:Boolean,interviews:Array},setup(e){const t=ot(),s=e,{projectId:n,searchActive:l,interviews:r}=Ve(s),o=Ce(!1),f=X(()=>t.byId(n.value)[0]),$=X(()=>o.value?r.value:r.value.slice(0,ze)),k=X(()=>!o.value&&r.value.length>ze),J=X(()=>o.value&&r.value.length>ze);return(P,C)=>{const R=lt,y=Lt;return b(),z("div",Tt,[Y("span",bt,[ye(R,{to:`/projects/${v(f).Slug}`},{default:nt(()=>[rt(we(v(f).Name),1)]),_:1},8,["to"]),v(l)?(b(),z("div",$t,we(v(r).length)+" results ",1)):de("",!0)]),v(l)&&v($).length>0?(b(),z("div",kt,[(b(!0),z(me,null,Se(v($),w=>(b(),st(y,{key:w.id,"interview-id":w.id,matches:w.matches,"project-slug":v(f).Slug},null,8,["interview-id","matches","project-slug"]))),128))])):de("",!0),v(l)?(b(),z(me,{key:1},[v(k)?(b(),z("button",{key:0,class:"expand-toggle",onClick:C[0]||(C[0]=w=>o.value=!0)},"show more")):de("",!0),v(J)?(b(),z("button",{key:1,class:"expand-toggle",onClick:C[1]||(C[1]=w=>o.value=!1)},"show less")):de("",!0)],64)):de("",!0)])}}},Bt=Ae(Mt,[["__scopeId","data-v-4d215b2b"]]),zt={class:"search-results"},Nt={__name:"SearchResults",props:{searchActive:Boolean,results:Array},setup(e){const t=e,{results:s,searchActive:n}=Ve(t);return(l,r)=>{const o=Bt;return b(),z("div",zt,[(b(!0),z(me,null,Se(v(s),f=>(b(),st(o,{key:f.id,"project-id":f.id,interviews:f.interviews,"search-active":v(n)},null,8,["project-id","interviews","search-active"]))),128))])}}},Pt=Ae(Nt,[["__scopeId","data-v-594e1f6b"]]),at=(e,t)=>e>t?1:e<t?-1:0,Ue=1/0,Ne=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),Je="eexxaacctt",Ot=new RegExp("\\p{P}","gu"),Ut="A-Z",Vt="a-z",Zt=["en",{numeric:!0,sensitivity:"base"}],ge=(e,t,s)=>e.replace(Ut,t).replace(Vt,s),Ye={unicode:!1,alpha:null,interSplit:"[^A-Za-z\\d']+",intraSplit:"[a-z][A-Z]",interBound:"[^A-Za-z\\d]",intraBound:"[A-Za-z]\\d|\\d[A-Za-z]|[a-z][A-Z]",interLft:0,interRgt:0,interChars:".",interIns:Ue,intraChars:"[a-z\\d']",intraIns:null,intraContr:"'[a-z]{1,2}\\b",intraMode:0,intraSlice:[1,Ue],intraSub:null,intraTrn:null,intraDel:null,intraFilt:(e,t,s)=>!0,toUpper:e=>e.toLocaleUpperCase(),toLower:e=>e.toLocaleLowerCase(),compare:null,sort:(e,t,s,n=at)=>{let{idx:l,chars:r,terms:o,interLft2:f,interLft1:$,start:k,intraIns:J,interIns:P,cases:C}=e;return l.map((R,y)=>y).sort((R,y)=>r[y]-r[R]||J[R]-J[y]||o[y]+f[y]+.5*$[y]-(o[R]+f[R]+.5*$[R])||P[R]-P[y]||k[R]-k[y]||C[y]-C[R]||n(t[l[R]],t[l[y]]))}},Pe=(e,t)=>t==0?"":t==1?e+"??":t==Ue?e+"*?":e+`{0,${t}}?`,Fe="(?:\\b|_)";function xe(e){e=Object.assign({},Ye,e);let{unicode:t,interLft:s,interRgt:n,intraMode:l,intraSlice:r,intraIns:o,intraSub:f,intraTrn:$,intraDel:k,intraContr:J,intraSplit:P,interSplit:C,intraBound:R,interBound:y,intraChars:w,toUpper:u,toLower:Z,compare:ie}=e;o??(o=l),f??(f=l),$??($=l),k??(k=l),ie??(ie=typeof Intl>"u"?at:new Intl.Collator(...Zt).compare);let D=e.letters??e.alpha;if(D!=null){let i=u(D),g=Z(D);C=ge(C,i,g),P=ge(P,i,g),y=ge(y,i,g),R=ge(R,i,g),w=ge(w,i,g),J=ge(J,i,g)}let ee=t?"u":"";const Ze='".+?"',ft=new RegExp(Ze,"gi"+ee),ht=new RegExp(`(?:\\s+|^)-(?:${w}+|${Ze})`,"gi"+ee);let{intraRules:je}=e;je==null&&(je=i=>{let g=Ye.intraSlice,_=0,A=0,c=0,h=0;if(/[^\d]/.test(i)){let I=i.length;I<=4?I>=3&&(c=Math.min($,1),I==4&&(_=Math.min(o,1))):(g=r,_=o,A=f,c=$,h=k)}return{intraSlice:g,intraIns:_,intraSub:A,intraTrn:c,intraDel:h}});let pt=!!P,gt=new RegExp(P,"g"+ee),dt=new RegExp(C,"g"+ee),mt=new RegExp("^"+C+"|"+C+"$","g"+ee),_t=new RegExp(J,"gi"+ee);const _e=(i,g=!1)=>{let _=[];i=i.replace(ft,c=>(_.push(c),Je)),i=i.replace(mt,""),g||(i=Z(i)),pt&&(i=i.replace(gt,c=>c[0]+" "+c[1]));let A=0;return i.split(dt).filter(c=>c!="").map(c=>c===Je?_[A++]:c)},vt=/[^\d]+|\d+/g,Ee=(i,g=0,_=!1)=>{let A=_e(i);if(A.length==0)return[];let c=Array(A.length).fill("");A=A.map((O,U)=>O.replace(_t,N=>(c[U]=N,"")));let h;if(l==1)h=A.map((O,U)=>{if(O[0]==='"')return Ne(O.slice(1,-1));let N="";for(let M of O.matchAll(vt)){let a=M[0],{intraSlice:m,intraIns:x,intraSub:p,intraTrn:S,intraDel:d}=je(a);if(x+p+S+d==0)N+=a+c[U];else{let[H,V]=m,q=a.slice(0,H),ne=a.slice(V),B=a.slice(H,V);x==1&&q.length==1&&q!=B[0]&&(q+="(?!"+q+")");let oe=B.length,re=[a];if(p)for(let j=0;j<oe;j++)re.push(q+B.slice(0,j)+w+B.slice(j+1)+ne);if(S)for(let j=0;j<oe-1;j++)B[j]!=B[j+1]&&re.push(q+B.slice(0,j)+B[j+1]+B[j]+B.slice(j+2)+ne);if(d)for(let j=0;j<oe;j++)re.push(q+B.slice(0,j+1)+"?"+B.slice(j+1)+ne);if(x){let j=Pe(w,1);for(let ae=0;ae<oe;ae++)re.push(q+B.slice(0,ae)+j+B.slice(ae)+ne)}N+="(?:"+re.join("|")+")"+c[U]}}return N});else{let O=Pe(w,o);g==2&&o>0&&(O=")("+O+")("),h=A.map((U,N)=>U[0]==='"'?Ne(U.slice(1,-1)):U.split("").map((M,a,m)=>(o==1&&a==0&&m.length>1&&M!=m[a+1]&&(M+="(?!"+M+")"),M)).join(O)+c[N])}let I=s==2?Fe:"",F=n==2?Fe:"",te=F+Pe(e.interChars,e.interIns)+I;return g>0?_?h=I+"("+h.join(")"+F+"|"+I+"(")+")"+F:(h="("+h.join(")("+te+")(")+")",h="(.??"+I+")"+h+"("+F+".*)"):(h=h.join(te),h=I+h+F),[new RegExp(h,"i"+ee),A,c]},Ie=(i,g,_)=>{let[A]=Ee(g);if(A==null)return null;let c=[];if(_!=null)for(let h=0;h<_.length;h++){let I=_[h];A.test(i[I])&&c.push(I)}else for(let h=0;h<i.length;h++)A.test(i[h])&&c.push(h);return c};let De=!!R,Le=new RegExp(y,ee),Te=new RegExp(R,ee);const He=(i,g,_)=>{let[A,c,h]=Ee(_,1),I=_e(_,!0),[F]=Ee(_,2),te=c.length,O=Array(te),U=Array(te);for(let p=0;p<te;p++){let S=c[p],d=I[p],H=S[0]=='"'?S.slice(1,-1):S+h[p],V=d[0]=='"'?d.slice(1,-1):d+h[p];O[p]=H,U[p]=V}let N=i.length,M=Array(N).fill(0),a={idx:Array(N),start:M.slice(),chars:M.slice(),cases:M.slice(),terms:M.slice(),interIns:M.slice(),intraIns:M.slice(),interLft2:M.slice(),interRgt2:M.slice(),interLft1:M.slice(),interRgt1:M.slice(),ranges:Array(N)},m=s==1||n==1,x=0;for(let p=0;p<i.length;p++){let S=g[i[p]],d=S.match(A),H=d.index+d[1].length,V=H,q=!1,ne=0,B=0,oe=0,re=0,j=0,ae=0,qe=0,Ge=0,Xe=0,ce=[];for(let E=0,T=2;E<te;E++,T+=2){let se=Z(d[T]),K=O[E],$e=U[E],Q=K.length,W=se.length,G=se==K;if(d[T]==$e&&qe++,!G&&d[T+1].length>=Q){let L=Z(d[T+1]).indexOf(K);L>-1&&(ce.push(V,W,L,Q),V+=be(d,T,L,Q),se=K,W=Q,G=!0,E==0&&(H=V))}if(m||G){let L=V-1,le=V+W,ue=!1,ve=!1;if(L==-1||Le.test(S[L]))G&&ne++,ue=!0;else{if(s==2){q=!0;break}if(De&&Te.test(S[L]+S[L+1]))G&&B++,ue=!0;else if(s==1){let Re=d[T+1],he=V+W;if(Re.length>=Q){let fe=0,pe=!1,xt=new RegExp(K,"ig"+ee),Ke;for(;Ke=xt.exec(Re);){fe=Ke.index;let Qe=he+fe,ke=Qe-1;if(ke==-1||Le.test(S[ke])){ne++,pe=!0;break}else if(Te.test(S[ke]+S[Qe])){B++,pe=!0;break}}pe&&(ue=!0,ce.push(V,W,fe,Q),V+=be(d,T,fe,Q),se=K,W=Q,G=!0,E==0&&(H=V))}if(!ue){q=!0;break}}}if(le==S.length||Le.test(S[le]))G&&oe++,ve=!0;else{if(n==2){q=!0;break}if(De&&Te.test(S[le-1]+S[le]))G&&re++,ve=!0;else if(n==1){q=!0;break}}G&&(j+=Q,ue&&ve&&ae++)}if(W>Q&&(Xe+=W-Q),E>0&&(Ge+=d[T-1].length),!e.intraFilt(K,se,V)){q=!0;break}E<te-1&&(V+=W+d[T+1].length)}if(!q){a.idx[x]=i[p],a.interLft2[x]=ne,a.interLft1[x]=B,a.interRgt2[x]=oe,a.interRgt1[x]=re,a.chars[x]=j,a.terms[x]=ae,a.cases[x]=qe,a.interIns[x]=Ge,a.intraIns[x]=Xe,a.start[x]=H;let E=S.match(F),T=E.index+E[1].length,se=ce.length,K=se>0?0:1/0,$e=se-4;for(let L=2;L<E.length;){let le=E[L].length;if(K<=$e&&ce[K]==T){let ue=ce[K+1],ve=ce[K+2],Re=ce[K+3],he=L,fe="";for(let pe=0;pe<ue;he++)fe+=E[he],pe+=E[he].length;E.splice(L,he-L,fe),T+=be(E,L,ve,Re),K+=4}else T+=le,L++}T=E.index+E[1].length;let Q=a.ranges[x]=[],W=T,G=T;for(let L=2;L<E.length;L++){let le=E[L].length;T+=le,L%2==0?G=T:le>0&&(Q.push(W,G),W=G=T)}G>W&&Q.push(W,G),x++}}if(x<i.length)for(let p in a)a[p]=a[p].slice(0,x);return a},be=(i,g,_,A)=>{let c=i[g]+i[g+1].slice(0,_);return i[g-1]+=c,i[g]=i[g+1].slice(_,_+A),i[g+1]=i[g+1].slice(_+A),c.length},wt=5,St=(i,g,_,A=1e3,c)=>{_=_?_===!0?wt:_:0;let h=null,I=null,F=[];g=g.replace(ht,a=>{let m=a.trim().slice(1);return m=m[0]==='"'?Ne(m.slice(1,-1)):m.replace(Ot,""),m!=""&&F.push(m),""});let te=_e(g),O;if(F.length>0){if(O=new RegExp(F.join("|"),"i"+ee),te.length==0){let a=[];for(let m=0;m<i.length;m++)O.test(i[m])||a.push(m);return[a,null,null]}}else if(te.length==0)return[null,null,null];if(_>0){let a=_e(g);if(a.length>1){let m=a.slice().sort((p,S)=>S.length-p.length);for(let p=0;p<m.length;p++){if((c==null?void 0:c.length)==0)return[[],null,null];c=Ie(i,m[p],c)}if(a.length>_)return[c,null,null];h=ct(a).map(p=>p.join(" ")),I=[];let x=new Set;for(let p=0;p<h.length;p++)if(x.size<c.length){let S=c.filter(H=>!x.has(H)),d=Ie(i,h[p],S);for(let H=0;H<d.length;H++)x.add(d[H]);I.push(d)}else I.push([])}}h==null&&(h=[g],I=[(c==null?void 0:c.length)>0?c:Ie(i,g)]);let U=null,N=null;if(F.length>0&&(I=I.map(a=>a.filter(m=>!O.test(i[m])))),I.reduce((a,m)=>a+m.length,0)<=A){U={},N=[];for(let a=0;a<I.length;a++){let m=I[a];if(m==null||m.length==0)continue;let x=h[a],p=He(m,i,x),S=e.sort(p,i,x,ie);if(a>0)for(let d=0;d<S.length;d++)S[d]+=N.length;for(let d in p)U[d]=(U[d]??[]).concat(p[d]);N=N.concat(S)}}return[[].concat(...I),U,N]};return{search:(...i)=>St(...i),split:_e,filter:Ie,info:He,sort:e.sort}}const Dt=(()=>{let e={A:"ÁÀÃÂÄĄ",a:"áàãâäą",E:"ÉÈÊËĖ",e:"éèêëę",I:"ÍÌÎÏĮ",i:"íìîïį",O:"ÓÒÔÕÖ",o:"óòôõö",U:"ÚÙÛÜŪŲ",u:"úùûüūų",C:"ÇČĆ",c:"çčć",L:"Ł",l:"ł",N:"ÑŃ",n:"ñń",S:"ŠŚ",s:"šś",Z:"ŻŹ",z:"żź"},t=new Map,s="";for(let r in e)e[r].split("").forEach(o=>{s+=o,t.set(o,r)});let n=new RegExp(`[${s}]`,"g"),l=r=>t.get(r);return r=>{if(typeof r=="string")return r.replace(n,l);let o=Array(r.length);for(let f=0;f<r.length;f++)o[f]=r[f].replace(n,l);return o}})();function ct(e){e=e.slice();let t=e.length,s=[e.slice()],n=new Array(t).fill(0),l=1,r,o;for(;l<t;)n[l]<l?(r=l%2&&n[l],o=e[l],e[l]=e[r],e[r]=o,++n[l],l=1,s.push(e.slice())):(n[l]=0,++l);return s}const Ht=(e,t)=>t?`<mark>${e}</mark>`:e,qt=(e,t)=>e+t;function Gt(e,t,s=Ht,n="",l=qt){n=l(n,s(e.substring(0,t[0]),!1))??n;for(let r=0;r<t.length;r+=2){let o=t[r],f=t[r+1];n=l(n,s(e.substring(o,f),!0))??n,r<t.length-3&&(n=l(n,s(e.substring(t[r+1],t[r+2]),!1))??n)}return n=l(n,s(e.substring(t[t.length-1]),!1))??n,n}xe.latinize=Dt;xe.permute=e=>ct([...Array(e.length).keys()]).sort((s,n)=>{for(let l=0;l<s.length;l++)if(s[l]!=n[l])return s[l]-n[l];return 0}).map(s=>s.map(n=>e[n]));xe.highlight=Gt;function Xt(e,t){const s=Object.create(null);for(let n=0;n<e.length;n++){const l=e[n],r=t(l);s[r]==null&&(s[r]=[]),s[r].push(l)}return s}const et=(e,t,s,n,l)=>{let r=s,o=0,f=e;for(;r>0&&s-r<l&&o<n;)f=f.slice(0,r),r=f.lastIndexOf(t),o++;return r<=0?0:r+t.length},tt=(e,t,s,n,l)=>{let r=s,o=0,f=e.slice(r);for(;f.indexOf(t>=0)&&r<e.length-1&&r-s<l&&o<n;){const $=f.indexOf(t)+t.length;f=f.slice($),r+=$,o++}return r-s>l?s+l:r},Kt=(e,t,s)=>{let n=et(e,". ",t,1,50);(n<0||n===t)&&(n=et(e," ",t,10,50));let l=tt(e,". ",s,1,50);return(l===s+50||l===s)&&(l=tt(e," ",s,10,50)),{excerpt:e.slice(n,l),min:n,max:l}},Oe=(e,t,s)=>{const n=new xe({interIns:20}),l=e.map(k=>k[t]),[r,o,f]=n.search(l,s);return r==null||r.length===0?[]:f.map(k=>{const J=o.idx[k],P=l[o.idx[k]],C=o.ranges[k],{excerpt:R,min:y,max:w}=Kt(P,C[0],C.slice(-1)[0]);let u=xe.highlight(R,C.map(Z=>Z-y)).trim();return y>0&&(u="[...] "+u),w<P.length&&(u=u+" [...]"),{index:J,field:t,highlighted:u,excerpt:R,min:y}})},ut=(e,t,s)=>{const n=Object.entries(e).map(([l,r])=>{const o=s[l];return{id:o.Id,projects:o.Projects,matches:r}});return t.map(l=>({id:l.Id,interviews:n.filter(r=>r.projects.includes(l.id))}))},Qt=(e,t)=>{const s=Object.fromEntries(t.map((n,l)=>[l,[]]));return ut(s,e,t)},Wt=(e,t,s)=>{const n=[...Oe(t,"Name",s),...Oe(t,"Description",s),...Oe(t,"Transcription",s)],l=Xt(n,r=>r.index);return ut(l,e,t)},Jt={class:"page-medium"},Yt={class:"filters"},Ft={class:"filters-row"},el={class:"filters-row"},tl={key:0,class:"too-generic-message"},ll={__name:"index",setup(e){const t=Ce(""),s=Ce(""),n=Ce(""),l=it(),r=ot(),o=X(()=>l.interviews),f=X(()=>r.projects),$=X(()=>f.value.filter(w=>{var Z,ie;let u=!0;return t.value!==""&&(u=((Z=w==null?void 0:w.Themes)==null?void 0:Z.includes(t.value))??!1),s.value!==""&&(u=((ie=w==null?void 0:w.Keywords)==null?void 0:ie.includes(s.value))??!1),u})),k=X(()=>{const w=f.value.map(({Themes:u})=>u).flat().filter(u=>!!u);return[...new Set(w)].sort((u,Z)=>u.localeCompare(Z))}),J=X(()=>{const w=f.value.map(({Keywords:u})=>u).flat().filter(u=>!!u);return[...new Set(w)].sort((u,Z)=>u.localeCompare(Z))}),P=X(()=>Qt($.value,o.value)),C=X(()=>n.value.length<3?P.value:Wt($.value,o.value,n.value)),R=X(()=>C.value.map(({interviews:u})=>u).flat().length>=o.value.length*.97),y=X(()=>R.value?P.value:C.value);return(w,u)=>{const Z=It,ie=Pt;return b(),z("div",Jt,[u[5]||(u[5]=Y("h1",null,"Oral History Projects",-1)),ye(Z,{name:"Oral History Projects"}),Y("div",Yt,[Y("div",Ft,[Me(Y("input",{"onUpdate:modelValue":u[0]||(u[0]=D=>Be(n)?n.value=D:null),type:"search",placeholder:"Search within oral histories"},null,512),[[Ct,v(n)]])]),Y("div",el,[Me(Y("select",{"onUpdate:modelValue":u[1]||(u[1]=D=>Be(t)?t.value=D:null)},[u[3]||(u[3]=Y("option",{value:""},"search by theme",-1)),(b(!0),z(me,null,Se(v(k),D=>(b(),z("option",{key:D},we(D),1))),128))],512),[[We,v(t)]]),Me(Y("select",{"onUpdate:modelValue":u[2]||(u[2]=D=>Be(s)?s.value=D:null)},[u[4]||(u[4]=Y("option",{value:""},"search by category",-1)),(b(!0),z(me,null,Se(v(J),D=>(b(),z("option",{key:D},we(D),1))),128))],512),[[We,v(s)]])])]),v(n).length>=3&&v(R)?(b(),z("div",tl," This query matched most of the interviews, try something more specific. ")):de("",!0),Y("div",null,[ye(ie,{"search-active":v(n).length>=3&&!v(R),results:v(y)},null,8,["search-active","results"])])])}}},cl=Ae(ll,[["__scopeId","data-v-4c8b1163"]]);export{cl as default};
