import{_ as vt}from"./CVUBOrwf.js";import{_ as et}from"./BO358h4A.js";import{_ as ye,k as Ue,f as q,l as wt,o as T,c as z,b as Ce,w as tt,d as lt,t as ve,u as w,a as J,F as de,r as we,g as Re,i as ge,e as nt,p as ke,v as St,q as Me,s as Ke}from"./L39PVerc.js";import{a as rt,u as st}from"./c_CbY5Rk.js";import"./Y9sJiLD5.js";import"./CEsQoeT9.js";const xt={class:"search-results-interview"},It={class:"preview"},Rt=["innerHTML"],Ct={__name:"SearchResultsInterview",props:{interviewId:Number,matches:Array,projectSlug:String},setup(e){const t=rt(),s=e,{interviewId:n,matches:l,projectSlug:r}=Ue(s),o=q(()=>t.byId(n.value)[0]),f=q(()=>l.value.filter(({field:k})=>!["Name"].includes(k))),$=wt({breaks:!0,html:!0});return(k,Q)=>{const P=et;return T(),z("div",xt,[Ce(P,{to:`/projects/${w(r)}/interviews/${w(o).Slug}`},{default:tt(()=>[lt(ve(w(o).Name),1)]),_:1},8,["to"]),J("div",It,[(T(!0),z(de,null,we(w(f),d=>(T(),z("div",{key:d.field},[J("div",{innerHTML:w($).render(d.highlighted)},null,8,Rt)]))),128))])])}}},yt=ye(Ct,[["__scopeId","data-v-7e2c7d20"]]),At={class:"search-results-project"},Lt={class:"title"},jt={key:0,class:"results-count"},Et={key:0,class:"interviews-list"},Be=3,bt={__name:"SearchResultsProject",props:{projectId:Number,searchActive:Boolean,interviews:Array},setup(e){const t=st(),s=e,{projectId:n,searchActive:l,interviews:r}=Ue(s),o=Re(!1),f=q(()=>t.byId(n.value)[0]),$=q(()=>o.value?r.value:r.value.slice(0,Be)),k=q(()=>!o.value&&r.value.length>Be),Q=q(()=>o.value&&r.value.length>Be);return(P,d)=>{const R=et,F=yt;return T(),z("div",At,[J("span",Lt,[Ce(R,{to:`/projects/${w(f).Slug}`},{default:tt(()=>[lt(ve(w(f).Name),1)]),_:1},8,["to"]),w(l)?(T(),z("div",jt,ve(w(r).length)+" results ",1)):ge("",!0)]),w(l)&&w($).length>0?(T(),z("div",Et,[(T(!0),z(de,null,we(w($),S=>(T(),nt(F,{key:S.id,"interview-id":S.id,matches:S.matches,"project-slug":w(f).Slug},null,8,["interview-id","matches","project-slug"]))),128))])):ge("",!0),w(l)?(T(),z(de,{key:1},[w(k)?(T(),z("button",{key:0,class:"expand-toggle",onClick:d[0]||(d[0]=S=>o.value=!0)},"show more")):ge("",!0),w(Q)?(T(),z("button",{key:1,class:"expand-toggle",onClick:d[1]||(d[1]=S=>o.value=!1)},"show less")):ge("",!0)],64)):ge("",!0)])}}},Tt=ye(bt,[["__scopeId","data-v-4d215b2b"]]),$t={class:"search-results"},kt={__name:"SearchResults",props:{searchActive:Boolean,results:Array},setup(e){const t=e,{results:s,searchActive:n}=Ue(t);return(l,r)=>{const o=Tt;return T(),z("div",$t,[(T(!0),z(de,null,we(w(s),f=>(T(),nt(o,{key:f.id,"project-id":f.id,interviews:f.interviews,"search-active":w(n)},null,8,["project-id","interviews","search-active"]))),128))])}}},Mt=ye(kt,[["__scopeId","data-v-594e1f6b"]]),Bt=new Intl.Collator("en",{numeric:!0,sensitivity:"base"}).compare,Oe=1/0,ze=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),Qe="eexxaacctt",zt=new RegExp("\\p{P}","gu"),Nt="A-Z",Pt="a-z",pe=(e,t,s)=>e.replace(Nt,t).replace(Pt,s),We={unicode:!1,alpha:null,interSplit:"[^A-Za-z\\d']+",intraSplit:"[a-z][A-Z]",interBound:"[^A-Za-z\\d]",intraBound:"[A-Za-z]\\d|\\d[A-Za-z]|[a-z][A-Z]",interLft:0,interRgt:0,interChars:".",interIns:Oe,intraChars:"[a-z\\d']",intraIns:null,intraContr:"'[a-z]{1,2}\\b",intraMode:0,intraSlice:[1,Oe],intraSub:null,intraTrn:null,intraDel:null,intraFilt:(e,t,s)=>!0,sort:(e,t,s)=>{let{idx:n,chars:l,terms:r,interLft2:o,interLft1:f,start:$,intraIns:k,interIns:Q,cases:P}=e;return n.map((d,R)=>R).sort((d,R)=>l[R]-l[d]||k[d]-k[R]||r[R]+o[R]+.5*f[R]-(r[d]+o[d]+.5*f[d])||Q[d]-Q[R]||$[d]-$[R]||P[R]-P[d]||Bt(t[n[d]],t[n[R]]))}},Ne=(e,t)=>t==0?"":t==1?e+"??":t==Oe?e+"*?":e+`{0,${t}}?`,Je="(?:\\b|_)";function Se(e){e=Object.assign({},We,e);let{unicode:t,interLft:s,interRgt:n,intraMode:l,intraSlice:r,intraIns:o,intraSub:f,intraTrn:$,intraDel:k,intraContr:Q,intraSplit:P,interSplit:d,intraBound:R,interBound:F,intraChars:S}=e;o??(o=l),f??(f=l),$??($=l),k??(k=l);let u=e.letters??e.alpha;if(u!=null){let i=u.toLocaleUpperCase(),g=u.toLocaleLowerCase();d=pe(d,i,g),P=pe(P,i,g),F=pe(F,i,g),R=pe(R,i,g),S=pe(S,i,g),Q=pe(Q,i,g)}let L=t?"u":"";const se='".+?"',W=new RegExp(se,"gi"+L),at=new RegExp(`(?:\\s+|^)-(?:${S}+|${se})`,"gi"+L);let{intraRules:Ae}=e;Ae==null&&(Ae=i=>{let g=We.intraSlice,v=0,y=0,c=0,h=0;if(/[^\d]/.test(i)){let C=i.length;C<=4?C>=3&&(c=Math.min($,1),C==4&&(v=Math.min(o,1))):(g=r,v=o,y=f,c=$,h=k)}return{intraSlice:g,intraIns:v,intraSub:y,intraTrn:c,intraDel:h}});let ct=!!P,ut=new RegExp(P,"g"+L),ft=new RegExp(d,"g"+L),ht=new RegExp("^"+d+"|"+d+"$","g"+L),pt=new RegExp(Q,"gi"+L);const me=(i,g=!1)=>{let v=[];i=i.replace(W,c=>(v.push(c),Qe)),i=i.replace(ht,""),g||(i=i.toLocaleLowerCase()),ct&&(i=i.replace(ut,c=>c[0]+" "+c[1]));let y=0;return i.split(ft).filter(c=>c!="").map(c=>c===Qe?v[y++]:c)},gt=/[^\d]+|\d+/g,Le=(i,g=0,v=!1)=>{let y=me(i);if(y.length==0)return[];let c=Array(y.length).fill("");y=y.map((O,U)=>O.replace(pt,N=>(c[U]=N,"")));let h;if(l==1)h=y.map((O,U)=>{if(O[0]==='"')return ze(O.slice(1,-1));let N="";for(let M of O.matchAll(gt)){let a=M[0],{intraSlice:_,intraIns:I,intraSub:p,intraTrn:x,intraDel:m}=Ae(a);if(I+p+x+m==0)N+=a+c[U];else{let[Z,V]=_,D=a.slice(0,Z),le=a.slice(V),B=a.slice(Z,V);I==1&&D.length==1&&D!=B[0]&&(D+="(?!"+D+")");let ie=B.length,ne=[a];if(p)for(let A=0;A<ie;A++)ne.push(D+B.slice(0,A)+S+B.slice(A+1)+le);if(x)for(let A=0;A<ie-1;A++)B[A]!=B[A+1]&&ne.push(D+B.slice(0,A)+B[A+1]+B[A]+B.slice(A+2)+le);if(m)for(let A=0;A<ie;A++)ne.push(D+B.slice(0,A+1)+"?"+B.slice(A+1)+le);if(I){let A=Ne(S,1);for(let oe=0;oe<ie;oe++)ne.push(D+B.slice(0,oe)+A+B.slice(oe)+le)}N+="(?:"+ne.join("|")+")"+c[U]}}return N});else{let O=Ne(S,o);g==2&&o>0&&(O=")("+O+")("),h=y.map((U,N)=>U[0]==='"'?ze(U.slice(1,-1)):U.split("").map((M,a,_)=>(o==1&&a==0&&_.length>1&&M!=_[a+1]&&(M+="(?!"+M+")"),M)).join(O)+c[N])}let C=s==2?Je:"",Y=n==2?Je:"",ee=Y+Ne(e.interChars,e.interIns)+C;return g>0?v?h=C+"("+h.join(")"+Y+"|"+C+"(")+")"+Y:(h="("+h.join(")("+ee+")(")+")",h="(.??"+C+")"+h+"("+Y+".*)"):(h=h.join(ee),h=C+h+Y),[new RegExp(h,"i"+L),y,c]},xe=(i,g,v)=>{let[y]=Le(g);if(y==null)return null;let c=[];if(v!=null)for(let h=0;h<v.length;h++){let C=v[h];y.test(i[C])&&c.push(C)}else for(let h=0;h<i.length;h++)y.test(i[h])&&c.push(h);return c};let Ve=!!R,je=new RegExp(F,L),Ee=new RegExp(R,L);const Ze=(i,g,v)=>{let[y,c,h]=Le(v,1),C=me(v,!0),[Y]=Le(v,2),ee=c.length,O=Array(ee),U=Array(ee);for(let p=0;p<ee;p++){let x=c[p],m=C[p],Z=x[0]=='"'?x.slice(1,-1):x+h[p],V=m[0]=='"'?m.slice(1,-1):m+h[p];O[p]=Z,U[p]=V}let N=i.length,M=Array(N).fill(0),a={idx:Array(N),start:M.slice(),chars:M.slice(),cases:M.slice(),terms:M.slice(),interIns:M.slice(),intraIns:M.slice(),interLft2:M.slice(),interRgt2:M.slice(),interLft1:M.slice(),interRgt1:M.slice(),ranges:Array(N)},_=s==1||n==1,I=0;for(let p=0;p<i.length;p++){let x=g[i[p]],m=x.match(y),Z=m.index+m[1].length,V=Z,D=!1,le=0,B=0,ie=0,ne=0,A=0,oe=0,De=0,He=0,qe=0,ae=[];for(let j=0,b=2;j<ee;j++,b+=2){let re=m[b].toLocaleLowerCase(),X=O[j],Te=U[j],G=X.length,K=re.length,H=re==X;if(m[b]==Te&&De++,!H&&m[b+1].length>=G){let E=m[b+1].toLocaleLowerCase().indexOf(X);E>-1&&(ae.push(V,K,E,G),V+=be(m,b,E,G),re=X,K=G,H=!0,j==0&&(Z=V))}if(_||H){let E=V-1,te=V+K,ce=!1,_e=!1;if(E==-1||je.test(x[E]))H&&le++,ce=!0;else{if(s==2){D=!0;break}if(Ve&&Ee.test(x[E]+x[E+1]))H&&B++,ce=!0;else if(s==1){let Ie=m[b+1],fe=V+K;if(Ie.length>=G){let ue=0,he=!1,_t=new RegExp(X,"ig"+L),Xe;for(;Xe=_t.exec(Ie);){ue=Xe.index;let Ge=fe+ue,$e=Ge-1;if($e==-1||je.test(x[$e])){le++,he=!0;break}else if(Ee.test(x[$e]+x[Ge])){B++,he=!0;break}}he&&(ce=!0,ae.push(V,K,ue,G),V+=be(m,b,ue,G),re=X,K=G,H=!0,j==0&&(Z=V))}if(!ce){D=!0;break}}}if(te==x.length||je.test(x[te]))H&&ie++,_e=!0;else{if(n==2){D=!0;break}if(Ve&&Ee.test(x[te-1]+x[te]))H&&ne++,_e=!0;else if(n==1){D=!0;break}}H&&(A+=G,ce&&_e&&oe++)}if(K>G&&(qe+=K-G),j>0&&(He+=m[b-1].length),!e.intraFilt(X,re,V)){D=!0;break}j<ee-1&&(V+=K+m[b+1].length)}if(!D){a.idx[I]=i[p],a.interLft2[I]=le,a.interLft1[I]=B,a.interRgt2[I]=ie,a.interRgt1[I]=ne,a.chars[I]=A,a.terms[I]=oe,a.cases[I]=De,a.interIns[I]=He,a.intraIns[I]=qe,a.start[I]=Z;let j=x.match(Y),b=j.index+j[1].length,re=ae.length,X=re>0?0:1/0,Te=re-4;for(let E=2;E<j.length;){let te=j[E].length;if(X<=Te&&ae[X]==b){let ce=ae[X+1],_e=ae[X+2],Ie=ae[X+3],fe=E,ue="";for(let he=0;he<ce;fe++)ue+=j[fe],he+=j[fe].length;j.splice(E,fe-E,ue),b+=be(j,E,_e,Ie),X+=4}else b+=te,E++}b=j.index+j[1].length;let G=a.ranges[I]=[],K=b,H=b;for(let E=2;E<j.length;E++){let te=j[E].length;b+=te,E%2==0?H=b:te>0&&(G.push(K,H),K=H=b)}H>K&&G.push(K,H),I++}}if(I<i.length)for(let p in a)a[p]=a[p].slice(0,I);return a},be=(i,g,v,y)=>{let c=i[g]+i[g+1].slice(0,v);return i[g-1]+=c,i[g]=i[g+1].slice(v,v+y),i[g+1]=i[g+1].slice(v+y),c.length},dt=5,mt=(i,g,v,y=1e3,c)=>{v=v?v===!0?dt:v:0;let h=null,C=null,Y=[];g=g.replace(at,a=>{let _=a.trim().slice(1);return _=_[0]==='"'?ze(_.slice(1,-1)):_.replace(zt,""),_!=""&&Y.push(_),""});let ee=me(g),O;if(Y.length>0){if(O=new RegExp(Y.join("|"),"i"+L),ee.length==0){let a=[];for(let _=0;_<i.length;_++)O.test(i[_])||a.push(_);return[a,null,null]}}else if(ee.length==0)return[null,null,null];if(v>0){let a=me(g);if(a.length>1){let _=a.slice().sort((p,x)=>x.length-p.length);for(let p=0;p<_.length;p++){if((c==null?void 0:c.length)==0)return[[],null,null];c=xe(i,_[p],c)}if(a.length>v)return[c,null,null];h=it(a).map(p=>p.join(" ")),C=[];let I=new Set;for(let p=0;p<h.length;p++)if(I.size<c.length){let x=c.filter(Z=>!I.has(Z)),m=xe(i,h[p],x);for(let Z=0;Z<m.length;Z++)I.add(m[Z]);C.push(m)}else C.push([])}}h==null&&(h=[g],C=[(c==null?void 0:c.length)>0?c:xe(i,g)]);let U=null,N=null;if(Y.length>0&&(C=C.map(a=>a.filter(_=>!O.test(i[_])))),C.reduce((a,_)=>a+_.length,0)<=y){U={},N=[];for(let a=0;a<C.length;a++){let _=C[a];if(_==null||_.length==0)continue;let I=h[a],p=Ze(_,i,I),x=e.sort(p,i,I);if(a>0)for(let m=0;m<x.length;m++)x[m]+=N.length;for(let m in p)U[m]=(U[m]??[]).concat(p[m]);N=N.concat(x)}}return[[].concat(...C),U,N]};return{search:(...i)=>mt(...i),split:me,filter:xe,info:Ze,sort:e.sort}}const Ot=(()=>{let e={A:"ÁÀÃÂÄĄ",a:"áàãâäą",E:"ÉÈÊËĖ",e:"éèêëę",I:"ÍÌÎÏĮ",i:"íìîïį",O:"ÓÒÔÕÖ",o:"óòôõö",U:"ÚÙÛÜŪŲ",u:"úùûüūų",C:"ÇČĆ",c:"çčć",L:"Ł",l:"ł",N:"ÑŃ",n:"ñń",S:"ŠŚ",s:"šś",Z:"ŻŹ",z:"żź"},t=new Map,s="";for(let r in e)e[r].split("").forEach(o=>{s+=o,t.set(o,r)});let n=new RegExp(`[${s}]`,"g"),l=r=>t.get(r);return r=>{if(typeof r=="string")return r.replace(n,l);let o=Array(r.length);for(let f=0;f<r.length;f++)o[f]=r[f].replace(n,l);return o}})();function it(e){e=e.slice();let t=e.length,s=[e.slice()],n=new Array(t).fill(0),l=1,r,o;for(;l<t;)n[l]<l?(r=l%2&&n[l],o=e[l],e[l]=e[r],e[r]=o,++n[l],l=1,s.push(e.slice())):(n[l]=0,++l);return s}const Ut=(e,t)=>t?`<mark>${e}</mark>`:e,Vt=(e,t)=>e+t;function Zt(e,t,s=Ut,n="",l=Vt){n=l(n,s(e.substring(0,t[0]),!1))??n;for(let r=0;r<t.length;r+=2){let o=t[r],f=t[r+1];n=l(n,s(e.substring(o,f),!0))??n,r<t.length-3&&(n=l(n,s(e.substring(t[r+1],t[r+2]),!1))??n)}return n=l(n,s(e.substring(t[t.length-1]),!1))??n,n}Se.latinize=Ot;Se.permute=e=>it([...Array(e.length).keys()]).sort((s,n)=>{for(let l=0;l<s.length;l++)if(s[l]!=n[l])return s[l]-n[l];return 0}).map(s=>s.map(n=>e[n]));Se.highlight=Zt;function Dt(e,t){const s={};for(let n=0;n<e.length;n++){const l=e[n],r=t(l);Object.hasOwn(s,r)||(s[r]=[]),s[r].push(l)}return s}const Ye=(e,t,s,n,l)=>{let r=s,o=0,f=e;for(;r>0&&s-r<l&&o<n;)f=f.slice(0,r),r=f.lastIndexOf(t),o++;return r<=0?0:r+t.length},Fe=(e,t,s,n,l)=>{let r=s,o=0,f=e.slice(r);for(;f.indexOf(t>=0)&&r<e.length-1&&r-s<l&&o<n;){const $=f.indexOf(t)+t.length;f=f.slice($),r+=$,o++}return r-s>l?s+l:r},Ht=(e,t,s)=>{let n=Ye(e,". ",t,1,50);(n<0||n===t)&&(n=Ye(e," ",t,10,50));let l=Fe(e,". ",s,1,50);return(l===s+50||l===s)&&(l=Fe(e," ",s,10,50)),{excerpt:e.slice(n,l),min:n,max:l}},Pe=(e,t,s)=>{const n=new Se({interIns:20}),l=e.map(k=>k[t]),[r,o,f]=n.search(l,s);return r==null||r.length===0?[]:f.map(k=>{const Q=o.idx[k],P=l[o.idx[k]],d=o.ranges[k],{excerpt:R,min:F,max:S}=Ht(P,d[0],d.slice(-1)[0]);let u=Se.highlight(R,d.map(L=>L-F)).trim();return F>0&&(u="[...] "+u),S<P.length&&(u=u+" [...]"),{index:Q,field:t,highlighted:u,excerpt:R,min:F}})},ot=(e,t,s)=>{const n=Object.entries(e).map(([l,r])=>{const o=s[l];return{id:o.Id,projects:o.Projects,matches:r}});return t.map(l=>({id:l.Id,interviews:n.filter(r=>r.projects.includes(l.id))}))},qt=(e,t)=>{const s=Object.fromEntries(t.map((n,l)=>[l,[]]));return ot(s,e,t)},Xt=(e,t,s)=>{const n=[...Pe(t,"Name",s),...Pe(t,"Description",s),...Pe(t,"Transcription",s)],l=Dt(n,r=>r.index);return ot(l,e,t)},Gt={class:"page-medium"},Kt={class:"filters"},Qt={class:"filters-row"},Wt={class:"filters-row"},Jt={key:0,class:"too-generic-message"},Yt={__name:"index",setup(e){const t=Re(""),s=Re(""),n=Re(""),l=rt(),r=st(),o=q(()=>l.interviews),f=q(()=>r.projects),$=q(()=>f.value.filter(S=>{var L,se;let u=!0;return t.value!==""&&(u=((L=S==null?void 0:S.Themes)==null?void 0:L.includes(t.value))??!1),s.value!==""&&(u=((se=S==null?void 0:S.Keywords)==null?void 0:se.includes(s.value))??!1),u})),k=q(()=>{const S=f.value.map(({Themes:u})=>u).flat().filter(u=>!!u);return[...new Set(S)].sort((u,L)=>u.localeCompare(L))}),Q=q(()=>{const S=f.value.map(({Keywords:u})=>u).flat().filter(u=>!!u);return[...new Set(S)].sort((u,L)=>u.localeCompare(L))}),P=q(()=>qt($.value,o.value)),d=q(()=>n.value.length<3?P.value:Xt($.value,o.value,n.value)),R=q(()=>d.value.map(({interviews:u})=>u).flat().length>=o.value.length*.97),F=q(()=>R.value?P.value:d.value);return(S,u)=>{const L=vt,se=Mt;return T(),z("div",Gt,[u[5]||(u[5]=J("h1",null,"Oral History Projects",-1)),Ce(L,{name:"Oral History Projects"}),J("div",Kt,[J("div",Qt,[ke(J("input",{"onUpdate:modelValue":u[0]||(u[0]=W=>Me(n)?n.value=W:null),type:"search",placeholder:"Search within oral histories"},null,512),[[St,w(n)]])]),J("div",Wt,[ke(J("select",{"onUpdate:modelValue":u[1]||(u[1]=W=>Me(t)?t.value=W:null)},[u[3]||(u[3]=J("option",{value:""},"search by theme",-1)),(T(!0),z(de,null,we(w(k),W=>(T(),z("option",{key:W},ve(W),1))),128))],512),[[Ke,w(t)]]),ke(J("select",{"onUpdate:modelValue":u[2]||(u[2]=W=>Me(s)?s.value=W:null)},[u[4]||(u[4]=J("option",{value:""},"search by category",-1)),(T(!0),z(de,null,we(w(Q),W=>(T(),z("option",{key:W},ve(W),1))),128))],512),[[Ke,w(s)]])])]),w(n).length>=3&&w(R)?(T(),z("div",Jt," This query matched most of the interviews, try something more specific. ")):ge("",!0),J("div",null,[Ce(se,{"search-active":w(n).length>=3&&!w(R),results:w(F)},null,8,["search-active","results"])])])}}},sl=ye(Yt,[["__scopeId","data-v-4c8b1163"]]);export{sl as default};
